<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <title>neo4jd3.js</title>
    <script src="/node_modules/jquery/dist/jquery.js"></script>
    <script src="/node_modules/bootstrap/dist/js/bootstrap.js"></script>

    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/neo4jd3.min.css?v=0.0.1">
    <style>
        body {
            height: 100%;
        }

        html {
            height: 100%;
        }

        .neo4jd3 {
            height: 95%;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <div id="neo4jd3"></div>
    <!--        <a href="https://github.com/eisman/neo4jd3"><img style="cursor: pointer; position: absolute; top: 0; right: 0; border: 0;" src="img/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub" data-canonical-src="img/forkme_right_gray_6d6d6d.png"></a>-->

    <!-- Scripts -->
    <script src="js/d3.min.js"></script>
    <script src="js/neo4jd3.js?v=0.0.1"></script>
    <script type="text/javascript">
        var neo4jData = {
            "results": [{ "columns": ["user", "entity"], "data": [{ "graph": { "nodes": [{ "id": "1", "labels": ["User"], "properties": { "userId": "eisman" } }, { "id": "2", "labels": ["Phone"], "properties": { "value": "555-555-5555" } }, { "id": "3", "labels": ["Address"], "properties": { "zipCode": "90210", "country": "US", "city": "BeverlyHills", "state": "CA" } }, { "id": "4", "labels": ["BirthDate"], "properties": { "value": 1326322800000 } }, { "id": "5", "labels": ["Password"], "properties": { "value": "123456" } }, { "id": "6", "labels": ["Device"], "properties": { "value": "eisman" } }, { "id": "7", "labels": ["SecurityChallengeAnswer"], "properties": { "value": "hCxh4LItmWefWg71JiYUaxxFrCRaqQIDEoEbeqHa" } }, { "id": "8", "labels": ["Project"], "properties": { "name": "neo4jd3", "title": "neo4jd3.js", "description": "Neo4jgraphvisualizationusingD3.js.", "url": "https://eisman.github.io/neo4jd3" } }, { "id": "9", "labels": ["Git"], "properties": { "url": "https://github.com/eisman/neo4jd3" } }, { "id": "10", "labels": ["Issues"], "properties": { "url": "https://github.com/eisman/neo4jd3/issues" } }, { "id": "11", "labels": ["Github"], "properties": { "url": "https://github.com" } }, { "id": "12", "labels": ["Project"], "properties": { "name": "neo4j", "title": "Neo4j", "description": "GraphsforEveryone", "url": "http://neo4j.com" } }, { "id": "13", "labels": ["Project"], "properties": { "name": "d3", "title": "D3.js", "description": "BringdatatolifewithSVG,CanvasandHTML.", "url": "https://d3js.org/" } }, { "id": "14", "labels": ["Email"], "properties": { "email": "eeisman@gmail.com" } }, { "id": "15", "labels": ["CreditCard"], "properties": { "number": "4916928406205705", "type": "visa" } }, { "id": "16", "labels": ["Options"], "properties": {} }, { "id": "17", "labels": ["Language"], "properties": { "lang": "en_us" } }, { "id": "18", "labels": ["Cookie"], "properties": { "value": "itgnxe0xmvb1tazaqmkpmfzg8m3ma62qskfwcexc" } }, { "id": "19", "labels": ["Ip"], "properties": { "address": "127.0.0.1" } }, { "id": "20", "labels": ["icons"], "properties": { "description": "MapnodelabelstoFontAwesomeicons", "type": "object", "example": { "Address": "home", "BirthDate": "birthday-cake", "Password": "asterisk", "Phone": "phone", "User": "user" }, "deafult": "{}" } }, { "id": "21", "labels": ["zoomIn"], "properties": { "description": "Scrolluptozoomin.", "type": "function" } }, { "id": "22", "labels": ["zoomOut"], "properties": { "description": "Scrolldowntozoomout.", "type": "function" } }, { "id": "23", "labels": ["zoomFit"], "properties": { "description": "Adjustthegraphtothecontaineronceithasbeenloaded.", "type": "boolean", "values": [true, false], "default": false } }, { "id": "24", "labels": ["Api"], "properties": {} }, { "id": "a25", "labels": ["Google"], "properties": { "url": "https://www.google.com/#q=\"neo4jd3\"" } }], "relationships": [{ "id": "1", "type": "HAS_PHONE_NUMBER", "startNode": "1", "endNode": "2", "properties": { "from": 1473581532586 } }, { "id": "2", "type": "HAS_ADDRESS", "startNode": "1", "endNode": "3", "properties": { "from": 1473581532586 } }, { "id": "3", "type": "HAS_BIRTH_DATE", "startNode": "1", "endNode": "4", "properties": { "from": 1473581532586 } }, { "id": "4", "type": "HAS_PASSWORD", "startNode": "1", "endNode": "5", "properties": { "from": 1473581532586 } }, { "id": "5", "type": "USED_DEVICE", "startNode": "1", "endNode": "6", "properties": { "from": 1473581532586 } }, { "id": "6", "type": "HAS_SECURITY_ANSWER", "startNode": "1", "endNode": "7", "properties": { "from": 1473581532586 } }, { "id": "7", "type": "DEVELOPES", "startNode": "1", "endNode": "8", "properties": { "from": 1470002400000 } }, { "id": "8", "type": "REPOSITORY", "startNode": "8", "endNode": "9", "properties": {} }, { "id": "9", "type": "ISSUES", "startNode": "8", "endNode": "10", "properties": {} }, { "id": "10", "type": "HOSTED_ON", "startNode": "8", "endNode": "11", "properties": {} }, { "id": "11", "type": "HOSTED_ON", "startNode": "12", "endNode": "11", "properties": {} }, { "id": "12", "type": "HOSTED_ON", "startNode": "13", "endNode": "11", "properties": {} }, { "id": "13", "type": "HAS_EMAIL", "startNode": "1", "endNode": "14", "properties": {} }, { "id": "14", "type": "USED_CREDIT_CARD", "startNode": "1", "endNode": "15", "properties": {} }, { "id": "15", "type": "DEPENDS_ON", "startNode": "8", "endNode": "12", "properties": {} }, { "id": "16", "type": "DEPENDS_ON", "startNode": "8", "endNode": "13", "properties": {} }, { "id": "17", "type": "OPTIONS", "startNode": "8", "endNode": "16", "properties": {} }, { "id": "18", "type": "HAS_LANGUAGE", "startNode": "6", "endNode": "17", "properties": {} }, { "id": "19", "type": "HAS_COOKIE", "startNode": "6", "endNode": "18", "properties": {} }, { "id": "20", "type": "HAS_IP", "startNode": "6", "endNode": "19", "properties": {} }, { "id": "21", "type": "ICONS", "startNode": "16", "endNode": "20", "properties": {} }, { "id": "22", "type": "ZOOM_IN", "startNode": "24", "endNode": "21", "properties": {} }, { "id": "23", "type": "ZOOM_OUT", "startNode": "24", "endNode": "22", "properties": {} }, { "id": "24", "type": "ZOOM_FIT", "startNode": "16", "endNode": "23", "properties": {} }, { "id": "25", "type": "API", "startNode": "8", "endNode": "24", "properties": {} }, { "id": "26", "type": "GOOGLE_SEARCH", "startNode": "8", "endNode": "a25", "properties": {} }] } }] }],
            "errors": [
                {
                    "id": "1",
                    "labels": [
                        "User"
                    ],
                    "properties": {
                        "userId": "eisman"
                    }
                }
            ]
        };
        function init(data) {
            console.log('init start')
            var neo4jd3 = new Neo4jd3('#neo4jd3', {
                highlight: [
                    {
                        class: 'Project',
                        // property: 'name',
                        // value: 'neo4jd3'
                    }, {
                        class: 'User',
                        property: 'userId',
                        value: 'eisman'
                    }
                ],
                icons: {
                    'Address': 'home',
                    'Api': 'gear',
                    'BirthDate': 'birthday-cake',
                    'Cookie': 'paw',
                    'CreditCard': 'credit-card',
                    'Device': 'laptop',
                    'Email': 'at',
                    'Git': 'git',
                    'Github': 'github',
                    'Google': 'google',
                    'icons': 'font-awesome',
                    'Ip': 'map-marker',
                    'Issues': 'exclamation-circle',
                    'Language': 'language',
                    'Options': 'sliders',
                    'Password': 'lock',
                    'Phone': 'phone',
                    'Project': 'folder-open',
                    'SecurityChallengeAnswer': 'commenting',
                    'User': 'user',
                    'zoomFit': 'arrows-alt',
                    'zoomIn': 'search-plus',
                    'zoomOut': 'search-minus'
                },
                // images: {
                //     'Address': 'img/twemoji/1f3e0.svg',
                //    'Api': 'img/twemoji/1f527.svg',
                //     'BirthDate': 'img/twemoji/1f382.svg',
                //     'Cookie': 'img/twemoji/1f36a.svg',
                //     'CreditCard': 'img/twemoji/1f4b3.svg',
                //     'Device': 'img/twemoji/1f4bb.svg',
                //     'Email': 'img/twemoji/2709.svg',
                //     'Git': 'img/twemoji/1f5c3.svg',
                //     'Github': 'img/twemoji/1f5c4.svg',
                //     'icons': 'img/twemoji/1f38f.svg',
                //     'Ip': 'img/twemoji/1f4cd.svg',
                //     'Issues': 'img/twemoji/1f4a9.svg',
                //     'Language': 'img/twemoji/1f1f1-1f1f7.svg',
                //     'Options': 'img/twemoji/2699.svg',
                //     'Password': 'img/twemoji/1f511.svg',
                //    'Phone': 'img/twemoji/1f4de.svg',
                //     'Project': 'img/twemoji/2198.svg',
                //     'Project|name|neo4jd3': 'img/twemoji/2196.svg',
                //    'SecurityChallengeAnswer': 'img/twemoji/1f4ac.svg',
                //     'User': 'img/twemoji/1f600.svg',
                //    'zoomFit': 'img/twemoji/2194.svg',
                //    'zoomIn': 'img/twemoji/1f50d.svg',
                //    'zoomOut': 'img/twemoji/1f50e.svg'
                // },
                minCollision: 60,
                // neo4jDataUrl: 'json/neo4jData.json',
                neo4jData: data,
                nodeRadius: 25,
                onNodeClick: function (node) {
                    // var url = "/two/name1=" + name1 + "&name2=" + name2 + "&type=" + type + "&limit=" + num
                    var name1 = node.properties.name
                    var jump_num = 1
                    var limit_num = 5
                    var url = "/one/entity=" + name1 + "&jump=" + jump_num + "&limit=" + limit_num

                    $.ajax({
                        type: "GET",
                        url: url,
                        contentType: 'application/json;charset=utf-8',
                        dataType: "json",
                        success: function (data) {
                            var data_new = JSON.parse(data_new)
                            var result = data_new.results.datas.graph
                            neo4jd3.updateWithD3Data(result)


                        }
                    })
                    // var maxNodes = 5,
                    //     data = neo4jd3.randomD3Data(node, maxNodes);
                    // console.log(data)
                    // neo4jd3.updateWithD3Data(data2);

                    // switch (node.id) {
                    //     case '25':
                    //         // Google
                    //         window.open(node.properties.url, '_blank');
                    //         break;
                    //     default:

                    // let data1 = {
                    //     "nodes": [
                    //         {
                    //             "id": "88",
                    //             "labels": ["human"],
                    //             "properties": {
                    //                 "name": "neo4jd3",
                    //             },
                    //             // 'x':830.0197746070576,
                    //             // 'y':200.86165821235676,
                    //         }
                    //     ],
                    //     "relationships": [
                    //         {
                    //             "id": "7",
                    //             "type": "DEVELOPES",
                    //             "startNode": "1",
                    //             "endNode": "88",
                    //             "properties": {
                    //                 "from": 1470002400000
                    //             },
                    //             "source": "1",
                    //             "target": "88",
                    //             "linknum": 1
                    //         }
                    //     ]
                    // }
                    // let data2 = {
                    //     "nodes": [
                    //         {
                    //             "id": "87",
                    //             "labels": ["hpy"],
                    //             "properties": {
                    //                 "name": "neo4jd3",
                    //             },
                    //             // 'x':830.0197746070576,
                    //             // 'y':200.86165821235676,
                    //         }
                    //     ],
                    //     "relationships": [
                    //         {
                    //             "id": "87",
                    //             "type": "DEVELOPES",
                    //             "startNode": "1",
                    //             "endNode": "87",
                    //             "properties": {
                    //                 "from": 1470002400000
                    //             },
                    //             "source": "1",
                    //             "target": "87",
                    //             "linknum": 1
                    //         }
                    //     ]
                    // }

                    // neo4jd3.updateWithD3Data(data1);
                    // break;
                    // }
                },
                onRelationshipDoubleClick: function (relationship) {
                    console.log('double click on relationship: ' + JSON.stringify(relationship));
                },
                zoomFit: true
            });
            console.log('init finish')
        }
        window.onload = init(neo4jData);

    </script>

    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
                m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-430863-29', 'auto');
        ga('send', 'pageview');
    </script>
    <form>
        <div class="row form-inline">

            <input type="text" id="start-node" class="form-control" placeholder="开始节点">
            <input type="text" id="path" class="form-control" placeholder="路径">
            <input type="text" id="end-node" class="form-control" placeholder="结束节点">
            <input type="number" id="limit-num" class="form-control" placeholder="返回条数">
            <button type="button" id="search" class="btn btn-primary">搜索</button>


        </div>
    </form>
    <script>
        $("#search").click(function () {
            // console.log('search')
            alert("search")
            var name1 = $("#start-node").val()
            var path = $("#path").val()
            var name2 = $("#end-node").val()
            var num = $("#limit-num").val()
            var type = num
            if (num == "") {
                num = 10
            }
            if (type == "" || type == null) {
                type = 0
            }

            console.log(name1)
            console.log(path)
            console.log(name2.length)
            console.log(num)
            //第二个名字是空且第一个名字非空则 one
            if ((name2 == "" || name2 == null) && name1 != "" && name1 != null) {
                // alert("one")
                var url = "/one/entity=" + name1 + "&jump=" + path + "&limit=" + num
                $.ajax({
                    url: url,
                    type: "GET",
                    contentType: 'application/json;charset=utf-8',
                    dataType: "json",
                    success: function (data) {
                        var data_new = JSON.parse(data)
                        window.onload = init(data_new);
                    }
                })
                //     .fail(function () {
                //         console.log(1111)
                //         data_new = {
                //             "results": [
                //                 {
                //                     "columns": ["user", "entity"],
                //                     "data": [
                //                         {
                //                             "graph": {
                //                                 "nodes": [
                //                                     {
                //                                         "id": "1",
                //                                         "labels": ["User"],
                //                                         "properties": {
                //                                             "userId": "eisman"
                //                                         }
                //                                     },
                //                                     {
                //                                         "id": "8",
                //                                         "labels": ["Project"],
                //                                         "properties": {
                //                                             "name": "neo4jd3",
                //                                             "title": "neo4jd3.js",
                //                                             "description": "Neo4j graph visualization using D3.js.",
                //                                             "url": "https://eisman.github.io/neo4jd3"
                //                                         }
                //                                     }
                //                                 ],
                //                                 "relationships": [
                //                                     {
                //                                         "id": "7",
                //                                         "type": "DEVELOPES",
                //                                         "startNode": "1",
                //                                         "endNode": "8",
                //                                         "properties": {
                //                                             "from": 1470002400000
                //                                         }
                //                                     }
                //                                 ]
                //                             }
                //                         }
                //                     ]
                //                 }
                //             ],
                //             "errors": []
                //         }

                //         window.onload = init(data_new);
                //         // window.location.reload();
                //     })
            }
            // 第一、二个名字都非空，则two，type=0最短 type=-1全部
            else if (name2 != "" && name2 != null) {
                alert("two")

                var url = "/two/name1=" + name1 + "&name2=" + name2 + "&type=" + type + "&limit=" + num
                $.ajax({
                    type: "GET",
                    url: url,
                    contentType: 'application/json;charset=utf-8',
                    dataType: "json",
                    success: function (data) {
                        var data_new = JSON.parse(data_new)
                        window.onload = init(data_new)

                    }
                })

            }

        })



          // function GetSearchNames(obj) {
        //     $.ajax({
        //         type:'Get',
        //         url:'',
        //         dataType:"json",
        //         success:function(data){
        //             var opstr = ""
        //             $.each(data,function(i,val){
        //                 opstr += "<option value=\""+val+"\">"+val+"</option>";
        //             })


        //         }
        //     })
        // }

    </script>



</body>

</html>